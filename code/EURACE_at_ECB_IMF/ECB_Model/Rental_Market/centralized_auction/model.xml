<xmodel version="2">
 <name>Rental_Market</name>
 <version></version>
 <description></description>
 <models/>
 <environment>
  <constants/>
  <functionFiles>
   <file>ClearingHouse_Functions.c</file>
   <file>Household_Functions.c</file>
  </functionFiles>
  <timeUnits/>
  <dataTypes/>
 </environment>
 <agents>
  <xagent>
   <name>Household</name>
   <description></description>
   <memory>
    <variable>
     <type>int</type>
     <name>months_home_seeking</name>
     <description>Number of months HH is in home seeking state. (used for bid adjustment)</description>
    </variable>
    <variable>
     <type>int</type>
     <name>months_vacant_units</name>
     <description>Number of months landlord has vacant units. (used for ask adjustment)</description>
    </variable>
    <variable>
     <type>price_index_adt</type>
     <name>hmr_price_index</name>
     <description>Household Main Residence Price Index. Measured as a sample mean of all prices for residential housing units.</description>
    </variable>
    <variable>
     <type>price_index_adt</type>
     <name>op_price_index</name>
     <description>Other Property Price Index. Measured as a sample mean of all prices for non-residential housing units.</description>
    </variable>
    <variable>
     <type>price_index_adt</type>
     <name>rent_price_index</name>
     <description>Rent Price Index. Measured as a sample mean of all rent prices.</description>
    </variable>
    <variable>
     <type>double</type>
     <name>rental_market_price_mean</name>
     <description></description>
    </variable>
        <variable>
     <type>double</type>
     <name>rental_market_price_index</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_mean</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_index</name>
     <description></description>
    </variable>
   </memory>
   <functions>
    <function>
       <name>Household_check_eviction</name>
       <description></description>
       <currentState>Household_Before_Rent_Payment</currentState>
       <nextState>Household_After_Check_Eviction</nextState>
       <inputs>
       <input>
       <messageName>landlord_cancel_rental_contract</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
         <op>EQ</op>
        <rhs>
         <value>m.tenant_id</value>
        </rhs>
       </filter>
     </input>
   </inputs>
   </function>
   	<function>
       <name>Household_pay_rent</name>
       <description></description>
       <currentState>Household_After_Check_Eviction</currentState>
       <nextState>Household_After_Rent_Payment</nextState>
       <outputs>
        <output>
         <messageName>rent_payment</messageName>
       </output>
      <output>
       <messageName>tenant_cancel_rental_contract</messageName>
      </output>     
     </outputs>
   </function>
   <function>
     <name>Household_receive_rent</name>
     <description>Function to receive rent</description>
     <currentState>Household_After_Rent_Payment</currentState>
     <nextState>Household_Switch_Rental_State</nextState>
     <inputs>
      <input>
       <messageName>rent_payment</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
         <op>EQ</op>
        <rhs>
         <value>m.landlord_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
   </function>
   <function>
     <name>Household_check_rental_contract</name>
     <description>Function to check rental contract status</description>
     <currentState>Household_Switch_Rental_State</currentState>
     <nextState>switched_rental_state</nextState>
     <inputs>
      <input>
       <messageName>tenant_cancel_rental_contract</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
         <op>EQ</op>
        <rhs>
         <value>m.landlord_id</value>
        </rhs>
       </filter>
     </input>
     </inputs>
     <outputs/>
    </function>
    <function>
     <name>Household_offer_rental_units</name>
     <description></description>
     <currentState>Household_Start_Rental_Market</currentState>
     <nextState>rental_01_landlord</nextState>
    	<condition>
      <lhs>  
        <lhs>
          <value>a.is_landlord</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
          <lhs>
            <value>a.plan_rent_hmr</value>
          </lhs>
          <op>EQ</op>
          <rhs>
            <value>0</value>
          </rhs>
      </rhs>
    </condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>rental_price_ask</messageName>
     </output>
     </outputs>
   </function>
    <function>
     <name>idle</name>
     <description>Idle for Household_sell_rental_units</description>
     <currentState>Household_Start_Rental_Market</currentState>
     <nextState>Household_End_Rental_Market</nextState>
	   <condition>
			<lhs>
          <lhs>
            <value>a.plan_rent_hmr</value>
          </lhs>
          <op>EQ</op>
          <rhs>
            <value>0</value>
          </rhs>
		  </lhs>
		  <op>AND</op>
		  <rhs>
		      <lhs>
            <value>a.is_landlord</value>
          </lhs>
          <op>EQ</op>
          <rhs>
            <value>0</value>
          </rhs>
		  </rhs>
     </condition>
     <inputs/>
     <outputs/>
   </function>
    <function>
     <name>Household_send_rental_bid</name>
     <description></description>
     <currentState>Household_Start_Rental_Market</currentState>
     <nextState>rental_01_tenant</nextState>
    	<condition>
          <lhs>
            <value>a.plan_rent_hmr</value>
          </lhs>
          <op>EQ</op>
          <rhs>
            <value>1</value>
          </rhs>
      </condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>rental_price_bid</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Household_receive_rental_matching_as_landlord</name>
     <description></description>
     <currentState>rental_01_landlord</currentState>
     <nextState>Household_End_Rental_Market</nextState>
      <inputs>
        <input>
         <messageName>rental_matching</messageName>
         <filter>
          <lhs>
           <value>a.id</value>
          </lhs>
          <op>EQ</op>
          <rhs>
           <value>m.landlord_id</value>
          </rhs>
         </filter>
        </input>
       </inputs>
       <outputs/>
     </function>
    <function>
     <name>Household_receive_rental_matching_as_tenant</name>
     <description></description>
     <currentState>rental_01_tenant</currentState>
     <nextState>Household_End_Rental_Market</nextState>
     <inputs>
      <input>
       <messageName>rental_matching</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.tenant_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs/>
    </function>
   </functions>
  </xagent>
   <xagent>
   <name>ClearingHouse</name>
   <description></description>
   <memory>
    <variable>
     <type>auction_adt</type>
     <name>rental_auction</name>
     <description></description>
    </variable>
            <variable>
     <type>int</type>
     <name>rental_market_failed_assesments</name>
     <description></description>
    </variable>
    <variable>
     <type>real_estate_bid_data_adt_array</type>
     <name>rental_market_past_bids</name>
     <description>array to keep past bids</description>
         </variable>
    <variable>
     <type>real_estate_ask_data_adt_array</type>
     <name>rental_market_past_asks</name>
     <description>array to keep past asks</description>
              </variable>

        <variable>
     <type>real_estate_transaction_data_adt_array</type>
     <name>rental_market_past_transactions</name>
     <description>array to keep past transactions</description>
    </variable>
    <variable>
     <type>tenant_adt_array</type>
     <name>init_tenants</name>
     <description></description>
    </variable>
    <variable>
     <type>int_array</type>
     <name>init_landlords</name>
     <description></description>
    </variable>
    <variable>
     <type>int_array</type>
     <name>init_owners</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>price_index</name>
     <description></description>
    </variable>
   </memory>
   <functions>
    <function>
     <name>ClearingHouse_recycle_unprocessed_rental_bids</name>
     <description></description>
     <currentState>Clearinghouse_Start_Rental_Market</currentState>
     <nextState>rental_00</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>rental_price_bid</messageName>
      </output>
      <output>
       <messageName>rental_price_ask</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>ClearingHouse_receive_rental_bids</name>
     <description></description>
     <currentState>rental_00</currentState>
     <nextState>rental_01</nextState>
     <inputs>
      <input>
       <messageName>rental_price_bid</messageName>
       <sort>
      	<key>price</key>
	      <order>ascend</order>
      	</sort>
      </input>
      <input>
       <messageName>rental_price_ask</messageName>
       <sort>
     	 <key>price</key>
	     <order>ascend</order>
	     </sort>
      </input>
     </inputs>
     <outputs/>
    </function>
    <function>
     <name>ClearingHouse_run_rental_auction</name>
     <description></description>
     <currentState>rental_01</currentState>
     <nextState>Clearinghouse_End_Rental_Market</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>rental_matching</messageName>
      </output>
     </outputs>
    </function>
   </functions>
  </xagent>
 </agents>
 <messages>
  <message>
   <name>rental_price_bid</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>bid_adt</type>
     <name>bid</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>rental_price_ask</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>ask_adt</type>
     <name>ask</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>rental_matching</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description>Tenant ID (only needed for messsage filter)</description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description>Landlord ID (only needed for messsage filter)</description>
    </variable>
    <variable>
     <type>real_estate_adt</type>
     <name>rental_unit</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>tenant_cancel_rental_contract</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description>Tenant ID</description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description>Landlord ID</description>
    </variable>
    <variable>
     <type>int</type>
     <name>object_id</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>landlord_cancel_rental_contract</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description>Tenant ID</description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description>Landlord ID</description>
    </variable>
    <variable>
     <type>int</type>
     <name>object_id</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>rent_payment</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description>Tenant ID</description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description>Landlord ID</description>
    </variable>
    <variable>
     <type>double</type>
     <name>monthly_rent</name>
     <description></description>
    </variable>
   </variables>
  </message>
 </messages>
</xmodel>