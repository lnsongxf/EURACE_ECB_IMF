<xmodel version="2">
 <name>Housing_Market</name>
 <version></version>
 <description></description>
 <models/>
 <environment>
  <constants/>
  <functionFiles>
   <file>ClearingHouse_Functions.c</file>
   <file>Household_Functions.c</file>
   <file>Household_aux_functions.c</file>
   <file>Bank_Functions.c</file>
  </functionFiles>
  <timeUnits/>
  <dataTypes>
   <dataType>
    <name>real_estate_transaction_data_adt</name>
    <description>ADT to store price and quality data for real estate transactions</description>
    <variables>
     <variable>
     <type>int</type>
     <name>day</name>
     <description></description>
    </variable>
     <variable>
     <type>double</type>
     <name>quality</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
   <dataType>
    <name>real_estate_bid_data_adt</name>
    <description>ADT to store bids</description>
    <variables>
     <variable>
     <type>int</type>
     <name>day</name>
     <description></description>
    </variable>
     <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>min_quality</name>
     <description></description>
    </variable>
        <variable>
     <type>double</type>
     <name>matched_to_quality</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
    <dataType>
    <name>real_estate_ask_data_adt</name>
    <description>ADT to store asks</description>
    <variables>
     <variable>
     <type>int</type>
     <name>day</name>
     <description></description>
    </variable>
     <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>quality</name>
     <description></description>
    </variable>
        <variable>
     <type>double</type>
     <name>matched_to_bid_price</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
   <dataType>
    <name>bid_adt</name>
    <description>Bid ADT for single-unit auction.</description>
    <variables>
     <variable>
     <type>int</type>
     <name>id</name>
     <description>ID of buyer</description>
    </variable>
     <variable>
     <type>double</type>
     <name>price</name>
     <description>Bid price; max. willingness to buy</description>
    </variable>
    <variable>
     <type>double</type>
     <name>min_quality</name>
     <description>reservation quality for this bid</description>
    </variable>
        <variable>
     <type>int</type>
     <name>for_op</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
   <dataType>
    <name>ask_adt</name>
    <description>Ask price ADT for single-unit auction.</description>
    <variables>
     <variable>
     <type>int</type>
     <name>object_id</name>
     <description>ID of housing unit to be sold.</description>
    </variable>
     <variable>
     <type>double</type>
     <name>quality</name>
     <description>quality of housing unit to be sold.</description>
    </variable>
     <variable>
     <type>int</type>
     <name>id</name>
     <description>ID of seller</description>
    </variable>
     <variable>
     <type>double</type>
     <name>price</name>
     <description>Ask price; min. willingness to sell.</description>
    </variable>
    <variable>
     <type>int</type>
     <name>months_on_market</name>
     <description>no of months this object is already on the market</description>
    </variable>
    </variables>
   </dataType>
   <dataType>
    <name>auction_orders_adt</name>
    <description>Orders ADT for house auction.</description>
    <variables>
    <variable>
     <type>bid_adt_array</type>
     <name>bids</name>
     <description></description>
    </variable>
    <variable>
     <type>ask_adt_array</type>
     <name>asks</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
   <dataType>
    <name>auction_adt</name>
    <description>Auction ADT for house auction: single unit Dutch auction.</description>
    <variables>
    <variable>
     <type>auction_orders_adt</type>
     <name>pending</name>
     <description></description>
    </variable>
    <variable>
     <type>auction_orders_adt</type>
     <name>unprocessed</name>
     <description></description>
    </variable>
    </variables>
   </dataType>
   </dataTypes>
 </environment>
 <agents>
  <xagent>
   <name>Household</name>
   <description></description>
   <memory>

    <variable>
     <type>double</type>
     <name>sampled_dsti</name>
     <description></description>
    </variable>

<variable>
     <type>double</type>
     <name>max_expenditure</name>
     <description></description>
    </variable>
            <variable>
     <type>double</type>
     <name>estimated_house_quality</name>
     <description></description>
    </variable>
                <variable>
     <type>double</type>
     <name>estimated_house_price</name>
     <description></description>
    </variable>
        <variable>
     <type>double</type>
     <name>estimated_rental_price</name>
     <description></description>
    </variable>

    <variable>
     <type>int</type>
     <name>sell_op_object_id</name>
     <description>ID of OP object to sell. -1:not present, GT 0: object_id to sell.</description>
    </variable>
    <variable>
     <type>int</type>
     <name>sell_op_object_index</name>
     <description>Index of OP object to sell. -1:not present, GT 0: object_id to sell.</description>
    </variable>
    <variable>
     <type>int</type>
     <name>sold_object_id</name>
     <description>Object_id to signal which house_adt was just sold. -1:not present, GT 0: object_id just sold.</description>
    </variable>
    <variable>
      <type>double</type>
      <name>housing_market_price_growth_factor</name>
      <description></description>
     </variable>
     <variable>
      <type>double</type>
      <name>rental_market_price_growth_factor</name>
      <description></description>
     </variable>
   </memory>
   <functions>
    <function>
     <name>Household_sell_real_estate</name>
     <description></description>
     <currentState>Household_Start_Housing_Market</currentState>
     <nextState>housing_01_sell</nextState>
    	<condition>
    		<lhs>
    		<value>a.plan_sell_real_estate</value>
    		</lhs>
    		<op>EQ</op>
    		<rhs>
    		<value>1</value>
    		</rhs>
    	</condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>real_estate_price_ask</messageName>
     </output>
     </outputs>
   </function>
    <function>
     <name>idle</name>
     <description>Idle for Household_sell_real_estate</description>
     <currentState>Household_Start_Housing_Market</currentState>
     <nextState>Household_After_Housing_Market</nextState>
      	<condition>
		    <lhs>
    		<lhs>
    		<value>a.plan_buy_real_estate</value>
    		</lhs>
    		<op>EQ</op>
    		<rhs>
    		<value>0</value>
    		</rhs>
    	</lhs>
    	<op>AND</op>
    	<rhs>
    		<lhs>
    		<value>a.plan_sell_real_estate</value>
    		</lhs>
    		<op>EQ</op>
    		<rhs>
    		<value>0</value>
    		</rhs>
    	</rhs>
    	</condition>
     <inputs/>
     <outputs/>
   </function>
    <function>
     <name>Household_buy_real_estate</name>
     <description></description>
     <currentState>Household_Start_Housing_Market</currentState>
     <nextState>housing_01_buy</nextState>
    	<condition>
    		<lhs>
    		<value>a.plan_buy_real_estate</value>
    		</lhs>
    		<op>EQ</op>
    		<rhs>
    		<value>1</value>
    		</rhs>
    	</condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>real_estate_price_bid</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Household_receive_real_estate_transaction_as_seller</name>
     <description></description>
     <currentState>housing_01_sell</currentState>
     <nextState>housing_02</nextState>
      <inputs>
      <input>
       <messageName>real_estate_transaction</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.seller_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs>
      <output>
      <messageName>landlord_cancel_rental_contract</messageName>
    </output>
    </outputs>
     </function>
    <function>
     <name>Household_full_mortgage_payment</name>
     <description>Household full mortgage repayment occurs after selling the HMR or OP. Uses indicators JUST_SOLD_HMR and JUST_SOLD_OP for case differentiation.</description>
     <currentState>housing_02</currentState>
     <nextState>Household_After_Housing_Market</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>full_mortgage_payment</messageName>
      </output>
     </outputs>
   </function>
    <function>
     <name>Household_receive_real_estate_transaction_as_buyer</name>
     <description></description>
     <currentState>housing_01_buy</currentState>
     <nextState>housing_01_accept_mortgage</nextState>
     <inputs>
      <input>
       <messageName>real_estate_transaction</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.buyer_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs>
      <output>
       <messageName>tenant_cancel_rental_contract</messageName>
      </output>     
    </outputs>
    </function>
    <function>
     <name>Household_accept_mortgage_loan</name>
     <description></description>
     <currentState>housing_01_accept_mortgage</currentState>
     <nextState>Household_After_Housing_Market</nextState>
     <inputs>
     </inputs>
     <outputs>
      <output>
      <messageName>mortgage_accepted</messageName>
    </output>
     </outputs>
    </function>
    <function>
     <name>Household_receive_seizure_recompensation</name>
     <description></description>
     <currentState>Household_After_Housing_Market</currentState>
     <nextState>Household_End_Housing_Market</nextState>
     <inputs>
     <input>
       <messageName>seized_collateral_recompensation</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.former_owner_id</value>
        </rhs>
       </filter>
     </input>
     </inputs>
     <outputs/>
    </function>
   </functions>
  </xagent>
   <xagent>
   <name>Bank</name>
   <description></description>
   <memory>
    <variable>
     <type>foreclosure_adt_array</type>
     <name>seized_collateral</name>
     <description></description>
    </variable>
   </memory>
   <functions>
    <function>
     <name>Bank_sell_real_estate</name>
     <description></description>
     <currentState>Bank_Start_Housing_Market</currentState>
     <nextState>housing_01</nextState>
  	 <condition>
  	  <lhs>
  		<value>a.plan_sell_real_estate</value>
  	  </lhs>
  		<op>EQ</op>
  	  <rhs>
  		<value>1</value>
  	  </rhs>
  	</condition>
     <inputs>
      <input>
       <messageName>real_estate_market_data</messageName>
      </input>
     </inputs>
     <outputs>
      <output>
       <messageName>real_estate_price_ask</messageName>
     </output>
     </outputs>
    </function>
    <function>
     <name>idle</name>
     <description>Idle for Bank_sell_real_estate</description>
     <currentState>Bank_Start_Housing_Market</currentState>
     <nextState>housing_02</nextState>
  	 <condition>
  	  <not>
  	  <lhs>
  		<value>a.plan_sell_real_estate</value>
  	  </lhs>
  		<op>EQ</op>
  	  <rhs>
  		<value>1</value>
  	  </rhs>
  	 </not>
  	</condition>
     <inputs/>
     <outputs/>
    </function>
    <function>
     <name>Bank_receive_real_estate_transaction</name>
     <description></description>
     <currentState>housing_01</currentState>
     <nextState>housing_02</nextState>
     <inputs>
      <input>
       <messageName>real_estate_transaction</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.seller_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs>
      <output>
       <messageName>seized_collateral_recompensation</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Bank_receive_full_mortgage_payments</name>
     <description></description>
     <currentState>housing_02</currentState>
     <nextState>housing_03</nextState>
     <inputs>
      <input>
       <messageName>full_mortgage_payment</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.bank_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs/>
    </function>
   </functions>
  </xagent>
   <xagent>
   <name>ClearingHouse</name>
   <description></description>
   <memory>
    <variable>
     <type>auction_adt</type>
     <name>house_auction</name>
     <description></description>
    </variable>

        <variable>
     <type>double</type>
     <name>market_info_price_diff</name>
     <description></description>
    </variable>

            <variable>
     <type>double</type>
     <name>market_info_quality_diff</name>
     <description></description>
    </variable>

        <variable>
     <type>int</type>
     <name>housing_market_failed_assesments</name>
     <description></description>
    </variable>
            <variable>
     <type>int</type>
     <name>housing_market_stored_observations</name>
     <description></description>
    </variable>
                <variable>
     <type>int</type>
     <name>rental_market_stored_observations</name>
     <description></description>
    </variable>
    <variable>
     <type>real_estate_transaction_data_adt_array</type>
     <name>housing_market_past_transactions</name>
     <description>array to keep past transactions</description>
    </variable>
    <variable>
     <type>real_estate_bid_data_adt_array</type>
     <name>housing_market_past_bids</name>
     <description>array to keep past bids</description>
    </variable>
        <variable>
     <type>real_estate_ask_data_adt_array</type>
     <name>housing_market_past_asks</name>
     <description>array to keep past asks</description>
    </variable>
   </memory>
   <functions>
    <function>
     <name>Clearinghouse_send_real_estate_market_info</name>
     <description></description>
     <currentState>Clearinghouse_Start_Housing_Market</currentState>
     <nextState>real_estate_market_info_send</nextState>
          <condition>
      <lhs>
      <lhs>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>GEQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </rhs>
    </lhs>
    <op>AND</op>
    <rhs>
      <time>
       <period>monthly</period>
       <phase>2</phase>
      </time>
    </rhs>
    </condition>
     <inputs>
      <input>
        <messageName>real_estate_market_info_request</messageName>
      </input>
    </inputs>
<outputs>
      <output>
        <messageName>real_estate_market_info_response</messageName>
      </output>
     </outputs>
    </function>

        <function>
     <name>Clearinghouse_asses_houses</name>
     <description></description>
     <currentState>real_estate_market_info_send</currentState>
     <nextState>houses_assesed</nextState>
     <inputs>
      <input>
        <messageName>asses_house_request</messageName>
      </input>
    </inputs>
<outputs>
      <output>
        <messageName>asses_house_response</messageName>
      </output>
     </outputs>
    </function>


    <function>
     <name>Clearinghouse_Send_Market_Data</name>
     <description></description>
     <currentState>houses_assesed</currentState>
     <nextState>ch_data_send</nextState>

     <inputs/>
     <outputs>
      <output>
        <messageName>real_estate_market_data</messageName>
      </output>
     </outputs>
    </function>     

    <function>
     <name>ClearingHouse_recycle_unprocessed_real_estate_bids</name>
     <description></description>
     <currentState>ch_data_send</currentState>
     <nextState>housing_00</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>real_estate_price_bid</messageName>
      </output>
      <output>
       <messageName>real_estate_price_ask</messageName>
      </output>
     </outputs>
    </function>  

    <function>
     <name>idle</name>
     <description>Idle to skip mortgage, housing and rental markets</description>
     <currentState>Clearinghouse_Start_Housing_Market</currentState>
     <nextState>Clearinghouse_End_Rental_Market</nextState>
     <condition>
      <not>
      <lhs>
      <lhs>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>GEQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </rhs>
    </lhs>
    <op>AND</op>
    <rhs>
      <time>
       <period>monthly</period>
       <phase>2</phase>
      </time>
    </rhs>
  </not>
    </condition>
     <inputs/>
     <outputs/>
    </function>


    <function>
     <name>ClearingHouse_receive_real_estate_bids</name>
     <description></description>
     <currentState>housing_00</currentState>
     <nextState>housing_01</nextState>
     <inputs>
      <input>
       <messageName>real_estate_price_bid</messageName>
       <sort><key>price</key><order>ascend</order></sort>
      </input>
      <input>
       <messageName>real_estate_price_ask</messageName>
       <sort><key>price</key><order>ascend</order></sort>
      </input>
     </inputs>
     <outputs/>
    </function>
    <function>
     <name>ClearingHouse_run_real_estate_auction</name>
     <description></description>
     <currentState>housing_01</currentState>
     <nextState>Clearinghouse_End_Housing_Market</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>real_estate_transaction</messageName>
      </output>
     </outputs>
    </function>
   </functions>
  </xagent>
 </agents>
 <messages>

<message>
  <name>asses_house_request</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>object_id</name>
     <description></description>
    </variable>
        <variable>
     <type>double</type>
     <name>quality</name>
     <description></description>
    </variable>
  </variables>
  </message>

<message>
    <name>asses_house_response</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>object_id</name>
     <description></description>
    </variable>
          <variable>
     <type>double</type>
     <name>value_estimated</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>rent_estimated</name>
     <description></description>
    </variable>
  </variables>
  </message>



  <message>
   <name>real_estate_market_info_request</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
        <variable>
     <type>int</type>
     <name>for_op</name>
     <description>set to 1 if seeking to buy OP</description>
    </variable>
    <variable>
     <type>double</type>
     <name>expenditure</name>
     <description>desired expenditure on housing market</description>
    </variable>
  </variables>
  </message>

    <message>
   <name>real_estate_market_info_response</name>
   <description></description>
   <variables>
        <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_quality</name>
     <description>estimated quality on housing market given desired expenditure</description>
    </variable>
        <variable>
     <type>double</type>
     <name>housing_market_price</name>
     <description>estimated price on housing market given desired expenditure</description>
    </variable>

    <variable>
     <type>double</type>
     <name>rental_market_quality</name>
     <description>estimated quality on rental market of the comparable unit</description>
    </variable>
        <variable>
     <type>double</type>
     <name>rental_market_price</name>
     <description>estimated price on rental market for a comparable unit </description>
    </variable>
      </variables>
  </message>

  <message>
   <name>house_price_index</name>
   <description>house_price_index msg is send by Eurostat to HH to inform about Housing_price_index and Rent_price_index. Every 1st day of calendar month.</description>
   <variables>
    <variable>
     <type>price_index_adt</type>
     <name>hmr_price_index</name>
     <description></description>
    </variable>
    <variable>
     <type>price_index_adt</type>
     <name>op_price_index</name>
     <description></description>
    </variable>
    <variable>
     <type>price_index_adt</type>
     <name>rent_price_index</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>subsistence_level</name>
   <description>Message sent from Eurostat to households containing information relevant for real estate sector initialization.</description>
   <variables>
    <variable>
     <type>double</type>
     <name>cpi</name>
     <description>Consumer price index</description>
    </variable>
    <variable>
     <type>double</type>
     <name>minimum_subsistence_level</name>
     <description></description>
    </variable>
     <variable>
      <type>double</type>
      <name>housing_market_price_growth_factor</name>
      <description></description>
     </variable>
     <variable>
      <type>double</type>
      <name>rental_market_price_growth_factor</name>
      <description></description>
     </variable>
          <variable>
      <type>double</type>
      <name>variable_rate_loans_base_rate</name>
      <description></description>
     </variable>
   </variables>
  </message>
  <message>
   <name>real_estate_market_data</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>rental_market_price_mean</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>rental_market_price_index</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_mean</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_index</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>clearinghouse_to_eurostat_data</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>rental_market_price_mean</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_mean</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>housing_market_price_index</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>rental_market_price_index</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>real_estate_price_bid</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>bid_adt</type>
     <name>bid</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>real_estate_price_ask</name>
   <description></description>
   <variables>
    <variable>
     <type>double</type>
     <name>price</name>
     <description></description>
    </variable>
    <variable>
     <type>ask_adt</type>
     <name>ask</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>real_estate_transaction</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>seller_id</name>
     <description>Seller ID (only needed for messsage filter)</description>
    </variable>
    <variable>
     <type>int</type>
     <name>buyer_id</name>
     <description>Buyer ID (only needed for messsage filter)</description>
    </variable>
    <variable>
     <type>real_estate_adt</type>
     <name>house</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>seized_collateral_recompensation</name>
   <description>Mesg from Bank to former owner of housing unit, to inform about a windfall profit due to selling the seized collateral at a price above the outstanding principal and interest on the mortgage.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>former_owner_id</name>
     <description>Former owner ID</description>
    </variable>
    <variable>
     <type>double</type>
     <name>amount</name>
     <description></description>
    </variable>
   </variables>
  </message>
 </messages>
</xmodel>
