<xmodel version="2">
 <name>Mortgage_Market</name>
 <version>Version 1.0, 25/08/2016</version>
 <description>Authors: Sander van der Hoog</description>
 <models/>
 <environment>
  <constants/>
  <functionFiles>
   <file>Bank_Functions.c</file>
   <file>Household_Functions.c</file>
   <file>Household_aux_functions.c</file>
  </functionFiles>
  <timeUnits/>
  <dataTypes/>
 </environment>
 <agents>
  <xagent>
   <name>Household</name>
   <description></description>
   <memory/>
   <functions>
    <function>
     <name>Household_check_mortgage_conditions</name>
     <description></description>
     <currentState>start_mortgage_market</currentState>
     <nextState>mortgage_000</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>mortgage_arrears</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Household_service_mortgage_debt</name>
     <description></description>
     <currentState>mortgage_000</currentState>
     <nextState>mortgage_001</nextState>
     <inputs/>
     <condition>
       <lhs>
        <value>a.have_mortgage</value>
       </lhs>
       <op>EQ</op>
       <rhs>
        <value>1</value>
       </rhs>
     </condition>
     <outputs>
      <output>
       <messageName>mortgage_payment</messageName>
      </output>
	    <output>
		   <messageName>mortgage_arrears</messageName>
	    </output>
    </outputs>
    </function>
    <function>
     <name>Household_npl_mortgage_debt</name>
     <description></description>
     <currentState>mortgage_001</currentState>
     <nextState>mortgage_002</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>mortgage_npl</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Household_writeoff_mortgage_debt</name>
     <description></description>
     <currentState>mortgage_002</currentState>
     <nextState>mortgage_00</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>mortgage_writeoff</messageName>
      </output>
      <output>
       <messageName>landlord_cancel_rental_contract</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>idle</name>
     <description>Idle function for mortgage servicing/default loop.</description>
     <currentState>mortgage_000</currentState>
     <nextState>mortgage_00</nextState>
     <condition>
      <not>
        <lhs>
         <value>a.have_mortgage</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>1</value>
        </rhs>
      </not>
     </condition>
     <inputs/>
     <outputs/>
    </function>
    <function>
     <name>Household_mortgage_loan_application</name>
     <description></description>
     <currentState>mortgage_00</currentState>
     <nextState>mortgage_01</nextState>
     <condition>
      <lhs>
       <value>a.request_mortgage</value>
      </lhs>
      <op>EQ</op>
      <rhs>
       <value>1</value>
      </rhs>
     </condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>mortgage_request</messageName>
      </output>
     </outputs>
    </function>
    <function>
     <name>Household_receive_mortgage_loan</name>
     <description></description>
     <currentState>mortgage_01</currentState>
     <nextState>Household_End_Mortgage_Market</nextState>
     <inputs>
      <input>
       <messageName>mortgage_contract</messageName>
        <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.household_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs/>
    </function>
    <function>
     <name>idle</name>
     <description>Idle function for mortgage request loop.</description>
     <currentState>mortgage_00</currentState>
     <nextState>Household_End_Mortgage_Market</nextState>
     <condition>
      <not>
       <lhs>
        <value>a.request_mortgage</value>
       </lhs>
       <op>EQ</op>
       <rhs>
        <value>1</value>
       </rhs>
      </not>
     </condition>
     <inputs/>
     <outputs/>
    </function>
   </functions>
  </xagent>
  <xagent>
   <name>Bank</name>
   <description></description>
   <memory>
    <variable>
     <type>mortgage_contract_adt_array</type>
     <name>mortgage_portfolio</name>
     <description>The portfolio of mortgages is a dynamic array, with items of type mortgage_contract_adt</description>
    </variable>
    <variable>
     <type>double</type>
     <name>total_mortgage_credit</name>
     <description>The total volume of mortgages credit of the bank.</description>
    </variable>

    <variable>
     <type>int</type>
     <name>mrtg_variable_offered_flow_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_variable_accepted_flow_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_fixed_offered_flow_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_fixed_accepted_flow_count</name>
     <description></description>
    </variable>        
    <variable>
     <type>int</type>
     <name>mrtg_total_offered_flow_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_total_accepted_flow_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_variable_offered_cum_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_variable_accepted_cum_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_fixed_offered_cum_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_fixed_accepted_cum_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_total_offered_cum_count</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>mrtg_total_accepted_cum_count</name>
     <description></description>
    </variable>

    <variable>
     <type>double</type>
     <name>mrtg_variable_pct_offered_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_pct_offered_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_variable_pct_accepted_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_pct_accepted_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_variable_accepted_pct_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_accepted_pct_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_accepted_pct_flow_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_variable_pct_offered_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_pct_offered_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_variable_pct_accepted_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_pct_accepted_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_fixed_accepted_pct_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_variable_accepted_pct_cum_ratio</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>mrtg_accepted_pct_cum_ratio</name>
     <description></description>
    </variable>

   </memory>
   <functions>
    <function>
     <name>Bank_send_max_expenditure_info</name>
     <description></description>
     <currentState>Bank_Start_Mortgage_Market</currentState>
     <nextState>mortgage_001a</nextState>
     <condition>
          <lhs>
          <lhs>
            <lhs>
              <value>iteration_loop</value>
            </lhs>
            <op>GEQ</op>
            <rhs>
              <value>a.init_transient_period</value>
            </rhs>
          </lhs>
          <op>AND</op>
          <rhs>
            <lhs>
              <value>a.switch_real_estate_sector</value>
            </lhs>
            <op>EQ</op>
            <rhs>
              <value>1</value>
            </rhs>
          </rhs>
        </lhs>
        <op>AND</op>
        <rhs>
          <time>
           <period>monthly</period>
           <phase>2</phase>
          </time>
        </rhs>
        </condition>
     <inputs>
      <input>
        <messageName>mortgage_max_expenditure_request</messageName>
      </input>
    </inputs>
      <outputs>
      <output>
        <messageName>mortgage_max_expenditure_response</messageName>
      </output>
     </outputs>
    </function>
	   
	   <function>
		   <name>Bank_set_pd_lgd_mortgage_loans</name>
		   <description></description>
		   <currentState>mortgage_001a</currentState>
		   <nextState>mortgage_001</nextState>
         
		   <inputs>
			   <input>
				   <messageName>mortgage_payment</messageName>
				   <filter>
					   <lhs>
						   <value>a.id</value>
					   </lhs>
					   <op>EQ</op>
					   <rhs>
						   <value>m.bank_id</value>
					   </rhs>
				   </filter>
			   </input>
			   <input>
				   <messageName>mortgage_arrears</messageName>
				   <filter>
					   <lhs>
						   <value>a.id</value>
					   </lhs>
					   <op>EQ</op>
					   <rhs>
						   <value>m.bank_id</value>
					   </rhs>
				   </filter>
			   </input>
			   <input>
				   <messageName>mortgage_npl</messageName>
				   <filter>
					   <lhs>
						   <value>a.id</value>
					   </lhs>
					   <op>EQ</op>
					   <rhs>
						   <value>m.bank_id</value>
					   </rhs>
				   </filter>
			   </input>
			   <input>
				   <messageName>mortgage_writeoff</messageName>
				   <filter>
					   <lhs>
						   <value>a.id</value>
					   </lhs>
					   <op>EQ</op>
					   <rhs>
						   <value>m.bank_id</value>
					   </rhs>
				   </filter>
			   </input>
		   </inputs>
		   <outputs/>
	   </function>
    <function>
     <name>Bank_receive_mortgage_payments</name>
     <description></description>
     <currentState>mortgage_001</currentState>
     <nextState>mortgage_002</nextState>
     <inputs>
      <input>
       <messageName>mortgage_payment</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.bank_id</value>
        </rhs>
       </filter>
       <sort>
          <key>household_id</key>
          <order>ascend</order>
       </sort>
       <random>false</random>
      </input>
     </inputs>
     <outputs/>
    </function>

    <function>
     <name>Bank_read_mortgage_arrears_messages</name>
     <description></description>
	 <currentState>mortgage_002</currentState>
     <nextState>mortgage_003</nextState>
     <inputs>
      <input>
       <messageName>mortgage_arrears</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.bank_id</value>
        </rhs>
       </filter>
      </input>
	  </inputs>
     <outputs/>
    </function>
	
	<function>
		<name>Bank_read_mortgage_npl_messages</name>
		<description></description>
		<currentState>mortgage_003</currentState>
		<nextState>mortgage_004</nextState>
		<inputs>
			<input>
				<messageName>real_estate_market_data</messageName>
			</input>
			<input>
				<messageName>mortgage_npl</messageName>
				<filter>
					<lhs>
						<value>a.id</value>
					</lhs>
					<op>EQ</op>
					<rhs>
						<value>m.bank_id</value>
					</rhs>
				</filter>
			</input>
		</inputs>
		<outputs/>
	</function>
	
	<function>
		<name>Bank_read_mortgage_writeoff_messages</name>
		<description></description>
		<currentState>mortgage_004</currentState>
		<nextState>mortgage_005</nextState>
		<inputs>
			<input>
				<messageName>real_estate_market_data</messageName>
			</input>
			<input>
				<messageName>mortgage_writeoff</messageName>
				<filter>
					<lhs>
						<value>a.id</value>
					</lhs>
					<op>EQ</op>
					<rhs>
						<value>m.bank_id</value>
					</rhs>
				</filter>
			</input>
		</inputs>
		<outputs>
    </outputs>
	</function>
	
  <function>
    <name>Bank_reconstruct_mortgage_portfolio</name>
    <description></description>
    <currentState>mortgage_005</currentState>
    <nextState>mortgage_006</nextState>
       <inputs>
         <input>
           <messageName>mortgage_payment</messageName>
           <filter>
             <lhs>
               <value>a.id</value>
             </lhs>
             <op>EQ</op>
             <rhs>
               <value>m.bank_id</value>
             </rhs>
           </filter>
         </input>
         <input>
           <messageName>mortgage_arrears</messageName>
           <filter>
             <lhs>
               <value>a.id</value>
             </lhs>
             <op>EQ</op>
             <rhs>
               <value>m.bank_id</value>
             </rhs>
           </filter>
         </input>
         <input>
           <messageName>mortgage_npl</messageName>
           <filter>
             <lhs>
               <value>a.id</value>
             </lhs>
             <op>EQ</op>
             <rhs>
               <value>m.bank_id</value>
             </rhs>
           </filter>
         </input>
       </inputs>
      </function>
  
      <function>
        <name>Bank_set_risk_exposure_amounts</name>
        <description></description>
        <currentState>mortgage_006</currentState>
        <nextState>mortgage_check_active_status</nextState>
        <inputs/>
        <outputs/>
    </function>
    
    <function>
     <name>idle</name>
     <description>Idle for Bank_process_mortgage_requests function.</description>
     <currentState>mortgage_check_active_status</currentState>
     <nextState>Bank_End_Mortgage_Market</nextState>
     <condition>
      <lhs>
        <lhs>
         <value>a.grant_loans_definitely</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>0</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
         <value>a.grant_loans_maybe</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>0</value>
        </rhs>
      </rhs>
     </condition>
     <inputs/>
     <outputs/>
    </function>

    <function>
     <name>Bank_process_mortgage_requests</name>
     <description></description>
     <currentState>mortgage_check_active_status</currentState>
     <nextState>Bank_End_Mortgage_Market</nextState>
     <condition>
      <lhs>
        <lhs>
         <value>a.grant_loans_definitely</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>1</value>
        </rhs>
      </lhs>
      <op>OR</op>
      <rhs>
        <lhs>
         <value>a.grant_loans_maybe</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>1</value>
        </rhs>
      </rhs>
     </condition>
     <inputs>
      <input>
       <messageName>mortgage_request</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.bank_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs>
      <output>
       <messageName>mortgage_contract</messageName>
      </output>
     </outputs>
    </function>
      <function>
     <name>Bank_process_mortgage_accepts</name>
     <description></description>
     <currentState>housing_03</currentState>
     <nextState>Bank_End_Housing_Market</nextState>
     <inputs>
      <input>
       <messageName>mortgage_accepted</messageName>
       <filter>
        <lhs>
         <value>a.id</value>
        </lhs>
        <op>EQ</op>
        <rhs>
         <value>m.bank_id</value>
        </rhs>
       </filter>
      </input>
     </inputs>
     <outputs>
     </outputs>
    </function>
    </functions>
  </xagent>
 </agents>
 <messages>
  <message>
   <name>mortgage_info</name>
   <description>mortgage_info msg is send by HH to Bank to inform about pre-existing mortgages. Done only once after a transient period.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  
  <message>
   <name>mortgage_max_expenditure_request</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_application_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>

    <message>
   <name>mortgage_max_expenditure_response</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>max_expenditure</name>
     <description></description>
    </variable>
   </variables>
  </message>

  <message>
   <name>mortgage_request</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_application_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>mortgage_contract</name>
   <description>Msg send by bank to hh when mortgage contract is approved.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
   <message>
   <name>mortgage_accepted</name>
   <description>Msg send by HH to bank when mortgage contract is accepted (=sucessful at housing market)</description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>mortgage_payment</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>full_mortgage_payment</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>mortgage_arrears</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>mortgage_npl</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>    
    <variable>
     <type>mortgage_contract_adt</type>
     <name>mortgage</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>mortgage_writeoff</name>
   <description></description>
   <variables>
    <variable>
     <type>int</type>
     <name>household_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>bank_id</name>
     <description></description>
    </variable>
    <variable>
     <type>foreclosure_adt</type>
     <name>house</name>
     <description>Housing object that will be foreclosed on (either MAIN_RESIDENCE or RENTAL_PROPERTY).</description>
    </variable>
   </variables>
  </message>
 </messages>
</xmodel>
