 <xmodel version="2">
 <name>Initialization module for housing, mortgage, rental markets</name>
 <version>Version 2.0, 13/06/2017</version>
 <description>Authors: Sander van der Hoog</description>
 <models/>
 <environment>
  <constants/>
  <functionFiles>
   <file>Household_init_functions.c</file>
   <file>Bank_init_functions.c</file>
  </functionFiles>
  <timeUnits/>
  <dataTypes/>
 </environment>
 <agents>
  <xagent>
   <name>Household</name>
   <description></description>
   <memory/>
    <functions>
    <function>
     <name>Household_init_mortgages</name>
     <description>Function to initialize the sythetic mortgage, consistent with online simulation data. Note: this function runs only once, when iteration is init_transient_period.</description>
     <currentState>init_00</currentState>
     <nextState>init_01</nextState>
     <condition>
      <lhs>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </rhs>
    </condition>
     <inputs/>
     <outputs>
      <output>
       <messageName>mortgage_info</messageName>
      </output>
     </outputs>
    </function>

    <function>
     <name>Household_init_rent</name>
     <description>Function to initialize the rent value.</description>
     <currentState>init_01</currentState>
     <nextState>init_011</nextState>
    </function>

    <function>
     <name>Household_init_housing_states</name>
     <description>Function to initialize the hoousing states</description>
     <currentState>init_011</currentState>
     <nextState>init_02</nextState>
     <inputs/>
     <outputs>
      <output>
       <messageName>homeless_info</messageName>
      </output>
      <output>
       <messageName>tenant_info</messageName>
      </output>
      <output>
       <messageName>owner_info</messageName>
      </output>
      <output>
       <messageName>landlord_info</messageName>
      </output>
     </outputs>
    </function>


    <function>
     <name>idle</name>
     <description>idle for Household_init_mortgages</description>
     <currentState>init_00</currentState>
     <nextState>init_02</nextState>
     <condition>
      <lhs>
		    <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>NEQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </rhs>
    </condition>
     <inputs/>
     <outputs/>
    </function>
    <function>
     <name>Household_read_subsistence_level</name>
     <description>Household reads minimal subsistence level from Eurostat message.</description>
     <currentState>init_02</currentState>
     <nextState>init_04</nextState>
     <condition>
       <time>
        <period>monthly</period>
        <phase>2</phase>
       </time>
     </condition>
     <inputs>
      <input>
          <messageName>subsistence_level</messageName>
    </input>
    </inputs>
     <outputs/>
    </function>
    <function>
     <name>idle</name>
     <description>idle to skip tenants/owners/landlords init functions</description>
     <currentState>init_02</currentState>
     <nextState>init_04</nextState>
     <condition>
      <not>
       <time>
        <period>monthly</period>
        <phase>2</phase>
       </time>
     </not>
     </condition>
     <inputs/>
     <outputs/>
    </function>  
    


    <function>
     <name>Household_read_rent_matching_info</name>
     <description>Function to initialize both tenant and landlords, receiving info from ClearingHouse. Note: this function runs only once, when iteration is init_transient_period.</description>
     <currentState>init_04</currentState>
	 <nextState>init_05</nextState>
     <condition>
      <lhs>
       <value>iteration_loop</value>
     </lhs>
     <op>EQ</op>
     <rhs>
       <value>a.init_transient_period</value>
     </rhs>
     </condition>
     <inputs>
      <input>
       <messageName>house_price_index</messageName>
      </input>
      <input>
       <messageName>tenant_rent_matching_info</messageName>
        <filter>
            <lhs>
             <value>a.id</value>
            </lhs>
            <op>EQ</op>
            <rhs>
             <value>m.tenant_id</value>
            </rhs>
       </filter>
      </input>
      <input>
       <messageName>landlord_rent_matching_info</messageName>
        <filter>
            <lhs>
             <value>a.id</value>
            </lhs>
            <op>EQ</op>
            <rhs>
             <value>m.landlord_id</value>
            </rhs>
       </filter>
      </input>
      <input>
       <messageName>hmr_matching_info</messageName>
        <filter>
            <lhs>
             <value>a.id</value>
            </lhs>
            <op>EQ</op>
            <rhs>
             <value>m.owner_id</value>
            </rhs>
       </filter>
      </input>
      </inputs>
	  <outputs/>
	  </function>

	<function>
	  <name>Household_disaggregate_initial_mortgages</name>
		<description>Function to disaggregate the initial_mortgages for OPs.</description>
		<currentState>init_05</currentState>
		<nextState>Household_after_init_mortgages_rent_housing</nextState>
		<inputs/>
		<outputs>
			<output>
				<messageName>mortgage_info</messageName>
			</output>
		</outputs>
	</function>
	<function>
     <name>idle</name>
     <description>idle to skip Household_read_rent_matching_info</description>
     <currentState>init_04</currentState>
     <nextState>Household_after_init_mortgages_rent_housing</nextState>
     <condition>
      <not>
      <lhs>
       <value>iteration_loop</value>
       </lhs>
       <op>EQ</op>
       <rhs>
       <value>a.init_transient_period</value>
      </rhs>
      </not>
     </condition>
     <inputs/>
     <outputs/>
    </function>
    </functions>
  </xagent>

  <xagent>
   <name>Bank</name>
   <description></description>
   <memory/>
    <functions>
    <function>
     <name>Bank_init_mortgages</name>
     <description>Function to initialize the bank's mortgage portfolio from data send by households. Note: this function runs only once, when iteration is init_transient_period.</description>
     <currentState>Bank_init_after_transient</currentState>
     <nextState>Bank_after_mortgage_init</nextState>
     <condition>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
     </condition>
     <inputs>
      <input>
       <messageName>mortgage_info</messageName>
      </input>
     </inputs>
	 <outputs>
		 <output>
			 <messageName>dividend_info</messageName>
		 </output>
	 </outputs>
    </function>
    <function>
     <name>idle</name>
     <description>idle for Bank_init_mortgages</description>
     <currentState>Bank_init_after_transient</currentState>
     <nextState>Bank_after_mortgage_init</nextState>
     <condition>
      <not>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </not>
     </condition>
     <inputs/>
     <outputs/>
    </function>
    </functions>
  </xagent>

  <xagent>
   <name>ClearingHouse</name>
   <description></description>
   <memory/>
    <functions>
    <function>
     <name>ClearingHouse_init_rent_matching</name>
     <description>Function to initialize the rental market, matching initial tenants and initial landlords. Note: this function runs only once, when iteration is init_transient_period.</description>
     <currentState>ClearingHouse_after_initialization</currentState>
     <nextState>ClearingHouse_init_after_transient</nextState>
     <condition>
      <lhs>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>AND</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>1</value>
        </rhs>
      </rhs>
     </condition>
     <inputs>
      <input>
       <messageName>tenant_info</messageName>
      </input>
      <input>
       <messageName>landlord_info</messageName>
      </input>
      <input>
       <messageName>owner_info</messageName>
      </input>
     </inputs>
     <outputs>
      <output>
       <messageName>tenant_rent_matching_info</messageName>
      </output>
      <output>
       <messageName>landlord_rent_matching_info</messageName>
      </output>
      <output>
       <messageName>hmr_matching_info</messageName>
      </output>
     </outputs>
    </function>
    </functions>
  </xagent>

    <function>
     <name>idle</name>
     <description>Idle for ClearingHouse_init_rent_matching.</description>
     <currentState>ClearingHouse_after_initialization</currentState>
     <nextState>ClearingHouse_init_after_transient</nextState>
     <condition>
      <lhs>
        <lhs>
          <value>iteration_loop</value>
        </lhs>
        <op>NEQ</op>
        <rhs>
          <value>a.init_transient_period</value>
        </rhs>
      </lhs>
      <op>OR</op>
      <rhs>
        <lhs>
          <value>a.switch_real_estate_sector</value>
        </lhs>
        <op>EQ</op>
        <rhs>
          <value>0</value>
        </rhs>
      </rhs>
     </condition>
     <inputs/>
     <outputs/>
     </function>


 </agents>
 <messages>
  <message>
   <name>tenant_info</name>
   <description>tenant_info msg is send by HH to ClearingHouse to inform about tenant status. Send every 2nd day of month, after transient period.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>monthly_rent</name>
     <description>Monthly rent payment. Derived from HFCS data, Household Servicing-to-Income ratio: HB2300 (monthly rent) / DI2000 (total net monthly income).</description>
    </variable>
   </variables>
  </message>
  <message>
   <name>landlord_info</name>
   <description>landlord_info msg is send by HH to ClearingHouse to inform about landlord status. Send every 2nd day of month, after transient period.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>op_value</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>owner_info</name>
   <description>owner_info msg is send by HH to ClearingHouse to inform about owner status (only HMR, no additional property). Send every 2nd day of month, after transient period.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
    <variable>
     <type>double</type>
     <name>hmr_value</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>homeless_info</name>
   <description>homeless_info msg is send by HH to ClearingHouse to inform about homeless status . Send every 2nd day of month, after transient period.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>id</name>
     <description></description>
    </variable>
   </variables>
  </message>
  <message>
   <name>tenant_rent_matching_info</name>
   <description>tenant_rent_matching_info msg is send by ClearingHouse to tenant HHs to inform them about rent_matching status. Done only once after transient period, to match the Tenants to Landlords.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description></description>
    </variable>
    <variable>
     <type>real_estate_adt</type>
     <name>rental_unit</name>
     <description>Rental unit info. Derived from tenant_info msg.</description>
    </variable>
   </variables>
  </message>
  <message>
   <name>landlord_rent_matching_info</name>
   <description>landlord_rent_matching_info msg is send by ClearingHouse to landlord HHs to inform about rent_matching status. Done only once after transient period, to match the Tenants to Landlords.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>tenant_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>landlord_id</name>
     <description></description>
    </variable>
    <variable>
     <type>real_estate_adt</type>
     <name>rental_unit</name>
     <description>Rental unit info. Derived from tenant_info msg.</description>
    </variable>
   </variables>
  </message>
  <message>
   <name>hmr_matching_info</name>
   <description>hmr_matching_info msg is send by ClearingHouse to HH to inform about HMR object_id. Done only once after transient period, to match Owners to object_ids.</description>
   <variables>
    <variable>
     <type>int</type>
     <name>owner_id</name>
     <description></description>
    </variable>
    <variable>
     <type>int</type>
     <name>object_id</name>
     <description></description>
    </variable>
   </variables>
  </message>
</messages>
</xmodel>